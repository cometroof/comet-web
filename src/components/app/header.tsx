import Burger from "./header-burger";
import HeaderMenu from "./header-menu";
import LanguageSelector from "./lang-selector";
import supabaseClient from "@/supabase/client";
import HeaderLogo from "./header-logo";

async function getSubmenuProduct() {
  const res = (
    await supabaseClient
      .from("product")
      .select("id,name,slug,is_under_product,order")
      .is("deleted_at", null)
      .order("is_under_product", { ascending: true })
  ).data;
  if (res) {
    const sorted = [...res].sort((a, b) => {
      if (a.is_under_product !== b.is_under_product) {
        return Number(b.is_under_product) - Number(a.is_under_product);
      }
      return a.order - b.order;
    });
    return sorted;
  }
  return null;
}

async function getSubmenuProject() {
  return (
    await supabaseClient
      .from("project_categories")
      .select("id,name,slug,name_id")
      .is("deleted_at", null)
      .order("order", { ascending: true })
      .limit(6)
  ).data;
}

export default async function Header() {
  const submenuProduct = await getSubmenuProduct();
  const submenuProject = await getSubmenuProject();

  return (
    <>
      <header className="w-full bg-black outer-wrapper-x py-6  sticky top-0 z-[999] h-header">
        <div className="inner-wrapper flex justify-between items-center gap-10">
          {/* LOGO ELEMENT */}
          <HeaderLogo>
            <svg
              width={161}
              height={38}
              viewBox="0 0 161 38"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              className="w-full h-auto object-contain"
            >
              <path
                d="M55.559 10.97c-.764-2.729-3.548-4.748-6.877-4.748a7.2 7.2 0 0 0-6.604 3.984c-3.11-.219-6.003-.491-8.677-.764C35.092 4.039 41.314 0 48.682 0c8.241 0 14.954 4.966 15.663 11.297-3.001-.054-5.948-.218-8.786-.327m-13.426 3.82c1.037 2.292 3.602 3.875 6.549 3.875s6.058-1.965 6.877-4.639l8.786-.327c-.764 6.276-7.477 11.188-15.663 11.188-7.313 0-13.48-3.93-15.227-9.333 2.675-.273 5.567-.546 8.678-.764M8.678 12.443c0 3.439 3.165 6.222 7.04 6.222a9.6 9.6 0 0 0 1.801-.164v.164c2.947-1.2 7.477-2.074 13.371-2.838-1.855 5.24-7.913 9.06-15.172 9.06C7.04 24.887 0 19.32 0 12.443 0 5.567 7.04 0 15.718 0c7.259 0 13.371 3.875 15.227 9.169-5.24-.655-9.442-1.42-12.39-2.402l-.436-.163-.6-.219a6.5 6.5 0 0 0-1.801-.218c-3.875 0-7.04 2.784-7.04 6.222M133.33.928H161v5.457h-9.824v17.356h-8.022V6.385h-9.824zM85.357 11.843 92.998.983h7.149V12.06zm-19.92-.491V.982h7.204l7.531 10.752zm0 12.17v-9.878l15.827-.382 1.528 2.238 1.638-2.293 15.717-.272v10.587h-8.404v-8.841l-5.785 8.569h-6.386l-5.676-8.569v8.896zM110.954.928h19.974v5.457h-19.974v3.111h19.974v5.458h-19.974v3.11h19.974v5.458h-28.052V12.935l17.901-.219v-.436l-17.901-.164V.873h8.078z"
                fill="#E30613"
              />
              <path
                d="M149.539 36.894h1.31a3.3 3.3 0 0 0 1.31-.219 2.13 2.13 0 0 0 .927-.6c.231-.237.417-.514.546-.819a3.18 3.18 0 0 0 0-2.019 2.2 2.2 0 0 0-.546-.819 2.13 2.13 0 0 0-.927-.6 3.3 3.3 0 0 0-1.31-.273h-1.31zm-.655-5.95h2.183c.429-.007.855.068 1.255.22a3 3 0 0 1 1.092.6c.331.295.608.646.819 1.036.205.444.298.931.272 1.42a3.1 3.1 0 0 1-.272 1.473c-.211.39-.488.741-.819 1.037a3.05 3.05 0 0 1-1.092.6c-.4.152-.826.226-1.255.218h-2.183zm-5.403 4.258h2.838l-1.419-3.493zm-.982 2.346h-.819l2.893-6.603h.655l2.837 6.603h-.764l-.709-1.746h-3.384zm-3.875-3.71h1.801l.546-.274a1.1 1.1 0 0 0 .218-.327.82.82 0 0 0 .109-.491.66.66 0 0 0-.109-.437 1.4 1.4 0 0 0-.218-.382l-.546-.218-.71-.11h-1.091zm-.71-2.893h1.965c.56-.02 1.113.132 1.583.436a1.53 1.53 0 0 1 .546 1.31 1.64 1.64 0 0 1-.546 1.365 2.73 2.73 0 0 1-1.583.436h-1.255v3.057h-.71zm-4.802 2.892h1.91c.197-.057.382-.15.545-.273l.219-.327q.094-.237.109-.491a1.3 1.3 0 0 0-.109-.437 1.4 1.4 0 0 0-.219-.382l-.545-.218-.764-.11h-1.146zm0 3.711h-.71v-6.603h2.074a2.73 2.73 0 0 1 1.583.436 1.86 1.86 0 0 1 .109 2.51 2.08 2.08 0 0 1-1.255.547l1.91 3.11h-.819l-1.801-3.056h-1.091zm-5.513-.654h3.493v.654h-4.202v-6.603h4.093v.6h-3.384v2.238h3.166v.655h-3.166zm-3.929.654h-.655v-6.003h-2.238v-.6h5.13v.6h-2.237zm-6.768-3.329a3.4 3.4 0 0 0-.163-1.037 3.8 3.8 0 0 0-.546-.927 1.7 1.7 0 0 0-.873-.6 2.5 2.5 0 0 0-1.092-.274 2.5 2.5 0 0 0-1.146.273 1.97 1.97 0 0 0-.873.6 3.8 3.8 0 0 0-.546.928 3.5 3.5 0 0 0 0 2.128q.206.504.546.929c.245.26.543.464.873.6.355.18.748.274 1.146.273.38-.007.753-.1 1.092-.273.338-.121.639-.328.873-.6a3.8 3.8 0 0 0 .546-.928c.112-.353.167-.721.163-1.092m.71 0a3.9 3.9 0 0 1-.218 1.42 3.8 3.8 0 0 1-.71 1.09 4.7 4.7 0 0 1-1.091.71 3.8 3.8 0 0 1-1.365.273 3.6 3.6 0 0 1-1.364-.273 3.2 3.2 0 0 1-1.092-.71 4 4 0 0 1-.764-1.09 3.9 3.9 0 0 1-.218-1.42 3.8 3.8 0 0 1 .218-1.364c.191-.405.449-.774.764-1.092a2.5 2.5 0 0 1 1.092-.71 3.6 3.6 0 0 1 1.364-.272c.468.007.93.1 1.365.273a3.4 3.4 0 0 1 1.091.71 3.22 3.22 0 0 1 .928 2.455m-12.716 2.675h1.309c.447.016.893-.059 1.31-.219a2.13 2.13 0 0 0 .928-.6 2.7 2.7 0 0 0 .546-.819 3.18 3.18 0 0 0 0-2.019 2.2 2.2 0 0 0-.546-.819 2.1 2.1 0 0 0-.928-.6 3.3 3.3 0 0 0-1.31-.273h-1.309zm-.655-5.95h2.183c.41-.006.819.068 1.2.22.423.11.815.315 1.147.6.331.295.608.646.818 1.036.179.452.272.933.273 1.42a3.9 3.9 0 0 1-.273 1.473c-.21.39-.487.741-.818 1.037-.332.284-.724.49-1.147.6-.381.151-.79.226-1.2.218h-2.183zm-2.402 5.567v-5.566h.71v6.603h-.873l-3.93-5.675v5.675h-.655v-6.603h.819zm-6.549 1.037h-.655v-6.603h.655zm-4.639-.654h3.057v.654h-3.712v-6.603h.655zm-6.167-1.692h2.838l-1.419-3.493zm-.982 2.346h-.819l2.893-6.603h.655l2.838 6.603h-.765l-.709-1.746h-3.384zm-2.51 0h-.656v-6.003H78.1v-.6h5.13v.6h-2.24zm-6.932-.654h3.493v.654H73.35v-6.603h4.094v.6H74.06v2.238h3.165v.655H74.06zm-5.73-.6 2.237-5.35h1.037v6.604h-.71v-5.73l-2.4 5.73h-.328l-2.401-5.73v5.73h-.656v-6.603h.983zm-12.553-5.35h.655v2.839h3.602v-2.838h.655v6.603h-.655v-3.11h-3.602v3.11h-.655zm-1.146 5.567q-.147.257-.382.437l-.546.382-.71.273-.764.11a3.6 3.6 0 0 1-1.364-.274c-.409-.158-.78-.4-1.091-.71a2.9 2.9 0 0 1-.71-1.09 3 3 0 0 1-.273-1.42 3.6 3.6 0 0 1 .983-2.456 2.5 2.5 0 0 1 1.091-.71 3.6 3.6 0 0 1 1.364-.272q.615.03 1.201.218c.43.172.807.454 1.092.819l-.6.437-.273-.328-.437-.273-.491-.163-.491-.11a2.5 2.5 0 0 0-1.147.273c-.334.13-.633.335-.873.6a2.5 2.5 0 0 0-.491.928c-.15.325-.226.68-.218 1.037-.012.376.063.75.218 1.092.096.34.264.657.491.928.255.248.55.451.873.6.355.18.748.274 1.147.273h.49l.492-.164.491-.327q.234-.182.382-.437zm-10.26.383h3.547v.654h-4.202v-6.603h4.093v.6H44.37v2.238h3.22v.655h-3.22zm-3.875.654h-.655v-6.003h-2.238v-.6h5.076v.6h-2.183zm-7.15-1.255 2.238-5.348h.982v6.603h-.655v-5.73l-2.401 5.73h-.328l-2.4-5.73v5.73h-.71v-6.603h1.037zm-5.294-2.074a3.6 3.6 0 0 0-.218-1.037 2 2 0 0 0-.546-.927 1.8 1.8 0 0 0-.819-.6 2.57 2.57 0 0 0-2.292 0 1.8 1.8 0 0 0-.818.6 2 2 0 0 0-.546.927c-.15.325-.226.68-.218 1.037-.012.376.063.75.218 1.092.095.353.283.673.546.928.224.258.504.464.818.6a2.57 2.57 0 0 0 2.293 0c.314-.136.594-.342.818-.6a2 2 0 0 0 .546-.928c.13-.35.203-.719.218-1.092m.71 0a3.9 3.9 0 0 1-.273 1.42 3.44 3.44 0 0 1-3.166 2.073 3.6 3.6 0 0 1-2.456-.982 2.9 2.9 0 0 1-.709-1.092 3.9 3.9 0 0 1-.273-1.419c.007-.467.1-.93.273-1.364a3.1 3.1 0 0 1 1.801-1.801 3.55 3.55 0 0 1 2.729 0c.413.15.786.393 1.091.71a3.6 3.6 0 0 1 .983 2.455m-7.532 2.292c-.116.172-.265.32-.436.437l-.546.382-.71.273-.764.11a3.6 3.6 0 0 1-2.456-.983 2.9 2.9 0 0 1-.71-1.092 3.9 3.9 0 0 1-.272-1.419c.007-.467.1-.93.273-1.364a3.1 3.1 0 0 1 1.8-1.801 3.8 3.8 0 0 1 1.365-.273c.408.02.812.093 1.201.218.43.172.806.454 1.092.819l-.6.437-.274-.328-.436-.273-.492-.163-.49-.11a2.5 2.5 0 0 0-1.147.273c-.334.13-.633.335-.873.6a2.5 2.5 0 0 0-.491.928c-.151.325-.226.68-.218 1.037-.012.376.062.75.218 1.092.096.34.264.657.491.928.255.248.55.451.873.6.355.18.748.274 1.146.273h.491l.546-.164.437-.327.436-.437zm-9.714.6a.5.5 0 0 1-.164.328.38.38 0 0 1-.328.164.49.49 0 0 1-.382-.164.38.38 0 0 1-.109-.327.44.44 0 0 1 .11-.382.5.5 0 0 1 .381-.164.38.38 0 0 1 .328.164.5.5 0 0 1 .164.382m-3.111.438H7.75v-6.004H5.512v-.6h5.13v.6H8.405zm-6.768-3.712h1.856l.491-.273.273-.327q.067-.242.055-.491a1.2 1.2 0 0 0-.055-.437l-.273-.382-.491-.273-.764-.109H1.637zm-.655-2.892h1.91c.56-.02 1.113.132 1.583.436a1.53 1.53 0 0 1 .546 1.31 1.64 1.64 0 0 1-.546 1.365 2.73 2.73 0 0 1-1.582.436H1.637v3.057H.982zm159.581 4.148c.015.295-.022.59-.109.873a2.1 2.1 0 0 1-.327.818 2.24 2.24 0 0 1-.764.655 2.78 2.78 0 0 1-2.402 0 2.24 2.24 0 0 1-.764-.655 2.1 2.1 0 0 1-.327-.818 5.5 5.5 0 0 1-.109-.873v-4.148h.655v4.038q.003.417.109.819c.054.218.164.437.218.6.098.154.229.284.382.382l.382.164.328.11h.655l.327-.11.382-.164a1.25 1.25 0 0 0 .382-.382c.105-.187.179-.39.218-.6q.106-.402.11-.819v-4.038h.654z"
                fill="#fff"
              />
            </svg>
          </HeaderLogo>

          <div className="flex gap-10">
            <LanguageSelector />
            <Burger />
          </div>
        </div>
      </header>
      {/*MENU*/}
      <HeaderMenu
        submenuProduct={submenuProduct}
        submenuProject={submenuProject}
      />
    </>
  );
}
